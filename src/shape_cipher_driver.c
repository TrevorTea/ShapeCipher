///////////////////////////////////////////////////////////////////////////////
///                                INCLUDES                                 ///
///////////////////////////////////////////////////////////////////////////////

#include "shape_cipher.h"

///////////////////////////////////////////////////////////////////////////////
///                                 DEFINES                                 ///
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
///                                  ENUMS                                  ///
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
///                                 STRUCTS                                 ///
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
///                                FUNCTIONS                                ///
///////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////
///                                   MAIN                                  ///
///////////////////////////////////////////////////////////////////////////////


int main(int argc, char** argv) {
    struct arglist* args = parse_args(argc, argv);
    char* path_or_msg = args->path_or_msg;
    char* mode = args->mode;
    char* outpath = args->outpath;
    int key = args->key;

    // Determine input message.
    char * msg = determine_msg(path_or_msg);

    // Determine whether to encrypt or decrypt and do.
    char* result = NULL;
    if (strcmp(mode, "encrypt") == 0) {
        result = encrypt(key, msg);
    }
    else if (strcmp(mode, "decrypt") == 0) {
        result = decrypt(key, msg);
    }
    
    // Determine output stream.
    FILE* out = NULL;
    if (outpath) {
        out = fopen(outpath, "w");
    }
    else out = stdout;

    // Output printing and resource cleanup.
    fprintf(out, "%s\n", result);
    free(result);
    free(msg);
    fclose(out);
    return 0;
}
